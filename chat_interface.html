<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .chat-box {
            width: 80%;
            max-width: 600px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            height: 80vh;
        }
        .chat-header {
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
        }
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .message {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 10px;
        }
        .message.sent {
            justify-content: flex-end;
        }
        .message .message-content {
            max-width: 70%;
            padding: 10px;
            border-radius: 8px;
            background-color: #f0f0f0;
            margin-right: 10px;
            word-wrap: break-word;
        }
        .message.sent .message-content {
            background-color: #007bff;
            color: #fff;
            align-self: flex-end;
        }
        .message.received .message-content {
            background-color: #e9ecef;
            color: #333;
            align-self: flex-start;
        }
        .message-input {
            display: flex;
            align-items: center;
            margin-top: 20px;
            position: fixed;
            bottom: 20px;
            width: calc(80% - 40px); /* 80% of chat box width minus padding */
            max-width: 600px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
        }
        .message-input input {
            flex: 1;
            border: none;
            outline: none;
            padding: 10px;
            font-size: 16px;
        }
        .send-button {
            background: none;
            border: none;
            cursor: pointer;
            outline: none;
            padding: 0 10px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="chat-box">
        <div class="chat-header" id="receiver-email">Receiver Email</div>
        <div class="messages" id="message-container"></div>
    </div>

    <form id="message-form" class="message-input">
        <input type="text" id="message-input" placeholder="Type your message...">
        <button type="submit" class="send-button"><i class="fas fa-paper-plane"></i></button>
    </form>

    <!-- Firebase JavaScript SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID",
            measurementId: "YOUR_MEASUREMENT_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Get the current user's email
        const currentUserEmail = firebase.auth().currentUser.email;

        // Get the recipient's email from the URL parameter (uploaderEmail)
        const urlParams = new URLSearchParams(window.location.search);
        const receiverEmail = urlParams.get('uploaderEmail');

        // Display the recipient's email at the top
        document.getElementById('receiver-email').textContent = receiverEmail;

        // Reference to the messages node in Firebase
        const messagesRef = database.ref('messages');

        // Load existing messages and listen for new ones
        function loadMessages() {
            messagesRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                displayMessage(message);
            });
        }

        // Display a message in the chat interface
        function displayMessage(message) {
            const messageContainer = document.getElementById('message-container');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');

            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            messageContent.textContent = message.message;

            if (message.sender === currentUserEmail) {
                messageElement.classList.add('sent');
            } else {
                messageElement.classList.add('received');
            }

            messageElement.appendChild(messageContent);
            messageContainer.appendChild(messageElement);

            // Scroll to bottom of messages
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }

        // Submit message when form is submitted
        document.getElementById('message-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const messageInput = document.getElementById('message-input');
            const messageText = messageInput.value.trim();

            if (messageText === '') return;

            // Save message to Firebase
            const newMessageRef = messagesRef.push();
            newMessageRef.set({
                sender: currentUserEmail,
                receiver: receiverEmail,
                message: messageText,
                timestamp: new Date().toISOString()
            });

            // Clear input field
            messageInput.value = '';
        });

        // Load messages on page load
        loadMessages();
    </script>
</body>
</html>
